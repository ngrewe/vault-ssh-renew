[tox]
envlist =
    clean
    py37-black
    py36
    py37
    py38
    report

isolated_build = True

[tox:.package]
basepython = python3

[testenv]
commands = poetry run pytest {envsitepackagesdir}/vault_ssh_renew --junit-xml=test-reports/test-report-{envname}.xml --cov --cov-append --cov-report=term-missing
install_command = pip install --pre {opts} {packages}
deps =
    poetry
    PyHamcrest
    pytest
    pytest-cov
    pytest-datafiles
    pytest-freezegun
    pytest-mock
    requests-mock
    click==6.6
    requests==2.12.4
    paramiko==2.0.0
setenv =
    LC_ALL=C.UTF-8
    LANG=C.UTF-8
depends =
    {py36,py37,py38}: clean
    report: py36,py37,py38

[testenv:py37-black]
deps =
    black
commands =
    black --check --diff vault_ssh_renew


[testenv:report]
deps = coverage
skip_install = true
commands =
    coverage report
    coverage html
    coverage xml

[testenv:clean]
deps = coverage
skip_install = true
commands = coverage erase